<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>㋡꧁정빈777꧂ - 이미지 업로드</title>
<link rel="icon" type="image/svg+xml" href='data:image/svg+xml;utf8,
<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 2000 2000">
  <defs>
    <linearGradient id="linearGradient1" x1="1576.7" y1="1817" x2="423.3" y2="183" gradientUnits="userSpaceOnUse">
      <stop offset="0" stop-color="%233478f6"/>
      <stop offset="1" stop-color="%2353b6f9"/>
    </linearGradient>
    <filter id="filter1" x="0" y="0" width="2000" height="2000" color-interpolation-filters="sRGB">
      <feFlood flood-color="%23000000" flood-opacity="0.52"/>
      <feComposite in2="SourceGraphic" operator="out"/>
      <feGaussianBlur stdDeviation="43"/>
      <feOffset dx="35" dy="24"/>
      <feComposite in2="SourceGraphic" operator="atop"/>
    </filter>
  </defs>
  <path fill="url(%23linearGradient1)" d="M 2000 1000 C 2000 448 1552 0 1000 0 C 448 0 0 448 0 1000 C 0 1552 448 2000 1000 2000 C 1552 2000 2000 1552 2000 1000 Z"/>
  <path fill="%23fff" filter="url(%23filter1)" d="M 1137 506 C 1252 449 1369 497 1427 625 L 1459 696 C 1484 752 1488 821 1471 878 L 1472 877 C 1535 891 1581 939 1608 997 L 1632 1052 C 1698 1199 1657 1324 1544 1381 L 1175 1565 L 972 1114 C 1002 1241 946 1377 834 1433 L 776 1462 C 654 1523 518 1467 449 1343 L 596 1269 C 625 1309 663 1331 708 1308 L 758 1283 C 813 1256 830 1185 802 1124 L 525 509 L 672 435 L 784 683 L 1137 506 Z M 1444 1232 C 1488 1210 1504 1149 1480 1095 L 1476 1085 C 1452 1033 1397 1007 1353 1029 L 1151 1130 L 1242 1333 L 1444 1232 Z M 1184 679 L 991 775 L 1084 981 L 1276 885 C 1319 864 1336 802 1312 749 L 1306 736 C 1283 684 1226 658 1184 679 Z"/>
</svg>' />

<!-- 공통 헤더 CSS -->
<link rel="stylesheet" href="header.css">

<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: #ffffff; overflow-x: hidden; min-height: 100vh; display: flex; flex-direction: column; }

  main { padding: 0; margin: 0; flex: 1; display: flex; align-items: center; justify-content: center; }

  .container { 
    background:#1a1a1a; 
    padding:40px 20px; 
    border-radius:16px; 
    box-shadow:0 0 30px rgba(0,0,0,0.6); 
    text-align:center; 
    width:90%; 
    max-width:600px; 
    margin: 60px auto;
  }
  h2 { margin-bottom:30px; font-size:28px; color:#3663FF; }

  /* 페이지 섹션 */
  .page { display:none; }
  .page.active { display:block; }

  /* 페이지 1: 업로드 */
  #uploadSection input[type="file"] { display:none; }
  #dropArea { 
    border:2px dashed #555; 
    border-radius:12px; 
    padding:40px 20px; 
    cursor:pointer; 
    margin-bottom:20px; 
    transition:all 0.3s; 
    background: #2a2a2a;
  }
  #dropArea:hover { 
    border-color:#3663FF; 
    background: #333;
    transform: translateY(-2px);
  }
  #dropArea p { margin:0; color:#aaa; font-size:16px; }
  #previewImg { display:none; max-width:90%; margin:20px auto; border-radius:10px; box-shadow:0 8px 25px rgba(54,99,255,0.3); }

  .upload-button { 
    background: #3663FF; 
    color:#fff; 
    padding:14px 28px; 
    margin:10px 0; 
    border:none; 
    border-radius:30px; 
    cursor:pointer; 
    font-size:16px; 
    transition:transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
    width:100%; 
  }
  .upload-button:hover { transform:translateY(-8px) scale(1.05); }
  .upload-button:active { background: #2952CC; }

  /* 페이지 2: 로딩 */
  #loadingSection { text-align:center; padding: 40px 0; }
  .spinner { 
    width:70px; 
    height:70px; 
    border:5px solid rgba(54,99,255,0.2); 
    border-top-color:#3663FF; 
    border-radius:50%; 
    animation:spin 1s linear infinite; 
    margin:30px auto; 
  }
  @keyframes spin { to { transform:rotate(360deg); } }
  #loadingSection p { color:#aaa; font-size:18px; margin-top:20px; }

  /* 페이지 3: 완료 */
  #completeSection { text-align:center; padding: 20px 0; }
  .check-icon { width:90px; height:90px; margin:20px auto 30px; }
  .check-icon svg { width:100%; height:100%; }
  #completeSection p { color:#3663FF; font-size:22px; font-weight:bold; margin:20px 0 30px; }

  /* 링크 복사용 UI */
  .link-container { display:flex; gap:10px; align-items:center; margin-bottom:15px; }
  #linkDisplay { 
    flex:1; 
    border:2px solid #555; 
    border-radius:8px; 
    padding:12px 16px; 
    background:#2a2a2a; 
    color:#fff; 
    font-size:14px; 
    overflow-x:auto; 
  }
  #copyBtn { 
    min-width:70px; 
    height:45px; 
    padding:0 20px; 
    border-radius:30px; 
    font-size:14px; 
    background: #3663FF; 
    color:#fff; 
    cursor:pointer; 
    border:none;
    transition:transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }
  #copyBtn:hover { transform:translateY(-5px) scale(1.05); }

  @media (max-width: 800px) {
    .container { 
      margin: 30px auto;
      padding: 30px 15px;
    }
    
    h2 { font-size: 24px; }
  }
</style>
</head>
<body>

<!-- 헤더 컨테이너 -->
<div id="header-container"></div>

<main>
<div class="container">
  <!-- 페이지 1: 업로드 -->
  <div id="uploadSection" class="page active">
    <h2>이미지 업로드</h2>
    <div id="dropArea">
      <p>📤 여기에 이미지 드래그 또는 클릭</p>
      <input type="file" id="fileInput" accept="image/*">
    </div>
    <img id="previewImg" src="" alt="미리보기">
    <button class="upload-button" id="uploadBtn">업로드</button>
  </div>

  <!-- 페이지 2: 로딩 -->
  <div id="loadingSection" class="page">
    <h2>업로드 중...</h2>
    <div class="spinner"></div>
    <p>잠시만 기다려 주세요</p>
  </div>

  <!-- 페이지 3: 완료 -->
  <div id="completeSection" class="page">
    <h2>업로드 완료</h2>
    <div class="check-icon">
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <circle cx="50" cy="50" r="45" fill="none" stroke="#3663FF" stroke-width="4"/>
        <path d="M 30 50 L 45 65 L 70 35" fill="none" stroke="#3663FF" stroke-width="6" stroke-linecap="round" stroke-linejoin="round">
          <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="0.5s" fill="freeze"/>
          <animate attributeName="stroke-dashoffset" from="100" to="0" dur="0.5s" fill="freeze"/>
        </path>
      </svg>
    </div>
    <p>업로드가 완료되었습니다</p>
    <div class="link-container">
      <input id="linkDisplay" type="text" readonly>
      <button id="copyBtn">복사</button>
    </div>
    <button class="upload-button" id="openPreviewBtn">미리보기 열기</button>
    <button class="upload-button" id="newUploadBtn">새로 업로드</button>
  </div>
</div>
</main>

<!-- 공통 헤더 JavaScript -->
<script src="header.js"></script>

<script>
// 업로드 페이지 로직
const dropArea = document.getElementById('dropArea');
const fileInput = document.getElementById('fileInput');
const previewImg = document.getElementById('previewImg');
const uploadBtn = document.getElementById('uploadBtn');
const copyBtn = document.getElementById('copyBtn');
const linkDisplay = document.getElementById('linkDisplay');
const openPreviewBtn = document.getElementById('openPreviewBtn');
const newUploadBtn = document.getElementById('newUploadBtn');

// 페이지 전환 함수
function showPage(pageName) {
  document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
  document.getElementById(pageName + 'Section').classList.add('active');
}

// 드래그 앤 드롭
dropArea.addEventListener('click', () => fileInput.click());
dropArea.addEventListener('dragover', e => { 
  e.preventDefault(); 
  dropArea.style.borderColor = '#3663FF'; 
});
dropArea.addEventListener('dragleave', e => { 
  e.preventDefault(); 
  dropArea.style.borderColor = '#555'; 
});
dropArea.addEventListener('drop', async e => {
  e.preventDefault(); 
  dropArea.style.borderColor = '#555';
  if(e.dataTransfer.files.length) { 
    fileInput.files = e.dataTransfer.files; 
    previewFile(e.dataTransfer.files[0]); 
  }
});

fileInput.addEventListener('change', () => { 
  if(fileInput.files.length) previewFile(fileInput.files[0]); 
});

function previewFile(file) {
  const reader = new FileReader();
  reader.onload = ev => { 
    previewImg.src = ev.target.result; 
    previewImg.style.display = 'block'; 
  };
  reader.readAsDataURL(file);
}

// 업로드 버튼
uploadBtn.addEventListener('click', async () => {
  const file = fileInput.files[0];
  if(!file) return alert('파일을 선택하세요!');

  // 페이지 2로 전환 (로딩)
  showPage('loading');

  const cloudName = 'dretlhsrk';
  const uploadPreset = 'unsigned_preset';
  const url = `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`;
  const formData = new FormData();
  formData.append('file', file);
  formData.append('upload_preset', uploadPreset);

  try {
    const res = await fetch(url, {method: 'POST', body: formData});
    const data = await res.json();
    
    if(data.secure_url) {
      const previewUrl = `${location.origin}/view.html?img=${encodeURIComponent(data.secure_url)}`;
      linkDisplay.value = previewUrl;

      // 복사 버튼
      copyBtn.onclick = () => {
        navigator.clipboard.writeText(previewUrl).then(() => {
          const originalText = copyBtn.textContent;
          copyBtn.textContent = "✔";
          copyBtn.style.background = "#00cc88";
          setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = "#3663FF";
          }, 1500);
        });
      };

      openPreviewBtn.onclick = () => window.open(previewUrl, '_blank');

      // 페이지 3으로 전환 (완료)
      showPage('complete');
    } else {
      throw new Error('업로드 실패');
    }
  } catch(e) {
    alert('업로드 실패');
    showPage('upload'); // 실패시 첫 페이지로
  }
});

// 새로 업로드 버튼
newUploadBtn.addEventListener('click', () => {
  fileInput.value = '';
  previewImg.style.display = 'none';
  previewImg.src = '';
  linkDisplay.value = '';
  showPage('upload');
});
</script>
</body>
</html>
