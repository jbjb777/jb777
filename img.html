<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>㋡꧁정빈777꧂ - 이미지 업로드</title>
<link rel="icon" type="image/svg+xml" href='data:image/svg+xml;utf8,
<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 2000 2000">
  <defs>
    <linearGradient id="linearGradient1" x1="1576.7" y1="1817" x2="423.3" y2="183" gradientUnits="userSpaceOnUse">
      <stop offset="0" stop-color="%233478f6"/>
      <stop offset="1" stop-color="%2353b6f9"/>
    </linearGradient>
    <filter id="filter1" x="0" y="0" width="2000" height="2000" color-interpolation-filters="sRGB">
      <feFlood flood-color="%23000000" flood-opacity="0.52"/>
      <feComposite in2="SourceGraphic" operator="out"/>
      <feGaussianBlur stdDeviation="43"/>
      <feOffset dx="35" dy="24"/>
      <feComposite in2="SourceGraphic" operator="atop"/>
    </filter>
  </defs>
  <path fill="url(%23linearGradient1)" d="M 2000 1000 C 2000 448 1552 0 1000 0 C 448 0 0 448 0 1000 C 0 1552 448 2000 1000 2000 C 1552 2000 2000 1552 2000 1000 Z"/>
  <path fill="%23fff" filter="url(%23filter1)" d="M 1137 506 C 1252 449 1369 497 1427 625 L 1459 696 C 1484 752 1488 821 1471 878 L 1472 877 C 1535 891 1581 939 1608 997 L 1632 1052 C 1698 1199 1657 1324 1544 1381 L 1175 1565 L 972 1114 C 1002 1241 946 1377 834 1433 L 776 1462 C 654 1523 518 1467 449 1343 L 596 1269 C 625 1309 663 1331 708 1308 L 758 1283 C 813 1256 830 1185 802 1124 L 525 509 L 672 435 L 784 683 L 1137 506 Z M 1444 1232 C 1488 1210 1504 1149 1480 1095 L 1476 1085 C 1452 1033 1397 1007 1353 1029 L 1151 1130 L 1242 1333 L 1444 1232 Z M 1184 679 L 991 775 L 1084 981 L 1276 885 C 1319 864 1336 802 1312 749 L 1306 736 C 1283 684 1226 658 1184 679 Z"/>
</svg>' />

<style>
  * { box-sizing: border-box; }
  body { margin:0; padding:0; font-family: 'Segoe UI', sans-serif; background:#121212; color:#fff; display:flex; justify-content:center; align-items:center; min-height:100vh; }
  .container { background:#1e1e1e; padding:30px 20px; border-radius:16px; box-shadow:0 0 30px rgba(0,0,0,0.6); text-align:center; width:90%; max-width:600px; position:relative; }
  h2 { margin-bottom:20px; font-size:22px; color:#00ffd5; }

  /* 나가기 버튼 */
  #exitBtn { position:absolute; top:15px; left:15px; width:40px; height:40px; border-radius:50%; font-size:24px; line-height:40px; text-align:center; background:linear-gradient(135deg,#00ffcc,#3366ff); color:white; border:none; cursor:pointer; box-shadow:0 8px 16px rgba(0,255,204,0.3); transition:all 0.3s; }
  #exitBtn:hover { transform:translateY(-2px); box-shadow:0 8px 16px rgba(0,255,204,0.5); }

  /* 페이지 섹션 */
  .page { display:none; }
  .page.active { display:block; }

  /* 페이지 1: 업로드 */
  #uploadSection input[type="file"] { display:none; }
  #dropArea { border:2px dashed #444; border-radius:12px; padding:20px; cursor:pointer; margin-bottom:15px; transition:border-color 0.3s; }
  #dropArea:hover { border-color:#00ffd5; }
  #dropArea p { margin:0; color:#aaa; }
  #previewImg { display:none; max-width:90%; margin:10px auto; border-radius:10px; box-shadow:0 0 10px rgba(0,255,204,0.3); }

  button { background:linear-gradient(135deg,#00ffcc,#3366ff); color:#fff; padding:12px 24px; margin:10px 5px; border:none; border-radius:30px; cursor:pointer; font-size:16px; transition:transform 0.2s ease, box-shadow 0.3s; width:100%; }
  button:hover { transform:translateY(-2px); box-shadow:0 8px 16px rgba(0,255,204,0.3); }

  /* 페이지 2: 로딩 */
  #loadingSection { text-align:center; }
  .spinner { width:60px; height:60px; border:4px solid rgba(0,255,204,0.2); border-top-color:#00ffd5; border-radius:50%; animation:spin 1s linear infinite; margin:30px auto; }
  @keyframes spin { to { transform:rotate(360deg); } }
  #loadingSection p { color:#aaa; font-size:18px; margin-top:20px; }

  /* 페이지 3: 완료 */
  #completeSection { text-align:center; }
  .check-icon { width:80px; height:80px; margin:20px auto; }
  .check-icon svg { width:100%; height:100%; }
  #completeSection p { color:#00ffd5; font-size:20px; font-weight:bold; margin:20px 0; }

  /* 링크 복사용 UI */
  .link-container { display:flex; gap:10px; align-items:center; margin-bottom:15px; }
  #linkDisplay { flex:1; border:2px dashed #555; border-radius:8px; padding:8px 12px; background:transparent; color:#fff; font-size:14px; overflow-x:auto; }
  #copyBtn { width:60px; height:40px; padding:0; border-radius:12px; font-size:14px; box-shadow:0 8px 16px rgba(0,255,204,0.3); background:linear-gradient(135deg,#00ffcc,#3366ff); color:#fff; cursor:pointer; }
  #copyBtn:hover { transform:translateY(-2px); box-shadow:0 8px 16px rgba(0,255,204,0.5); }
</style>
</head>
<body>

<div class="container">
  <button id="exitBtn" title="나가기">×</button>

  <!-- 페이지 1: 업로드 -->
  <div id="uploadSection" class="page active">
    <h2>이미지 업로드</h2>
    <div id="dropArea">
      <p>여기에 이미지 드래그 또는 클릭</p>
      <input type="file" id="fileInput" accept="image/*">
    </div>
    <img id="previewImg" src="" alt="미리보기">
    <button id="uploadBtn">업로드</button>
  </div>

  <!-- 페이지 2: 로딩 -->
  <div id="loadingSection" class="page">
    <h2>변환 중...</h2>
    <div class="spinner"></div>
    <p>잠시만 기다려 주세요</p>
  </div>

  <!-- 페이지 3: 완료 -->
  <div id="completeSection" class="page">
    <h2>변환 완료</h2>
    <div class="check-icon">
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <circle cx="50" cy="50" r="45" fill="none" stroke="#00ff88" stroke-width="4"/>
        <path d="M 30 50 L 45 65 L 70 35" fill="none" stroke="#00ff88" stroke-width="6" stroke-linecap="round" stroke-linejoin="round">
          <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="0.5s" fill="freeze"/>
          <animate attributeName="stroke-dashoffset" from="100" to="0" dur="0.5s" fill="freeze"/>
        </path>
      </svg>
    </div>
    <p>변환이 완료되었습니다</p>
    <div class="link-container">
      <input id="linkDisplay" type="text" readonly>
      <button id="copyBtn">복사</button>
    </div>
    <button id="openPreviewBtn">미리보기 열기</button>
    <button id="newUploadBtn">새로 업로드</button>
  </div>
</div>

<script>
const exitBtn = document.getElementById('exitBtn');
exitBtn.onclick = () => window.location.href = 'http://jbjb.r-e.kr';

const dropArea = document.getElementById('dropArea');
const fileInput = document.getElementById('fileInput');
const previewImg = document.getElementById('previewImg');
const uploadBtn = document.getElementById('uploadBtn');
const copyBtn = document.getElementById('copyBtn');
const linkDisplay = document.getElementById('linkDisplay');
const openPreviewBtn = document.getElementById('openPreviewBtn');
const newUploadBtn = document.getElementById('newUploadBtn');

// 페이지 전환 함수
function showPage(pageName) {
  document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
  document.getElementById(pageName + 'Section').classList.add('active');
}

// 드래그 앤 드롭
dropArea.addEventListener('click', () => fileInput.click());
dropArea.addEventListener('dragover', e => { 
  e.preventDefault(); 
  dropArea.style.borderColor = '#00ffd5'; 
});
dropArea.addEventListener('dragleave', e => { 
  e.preventDefault(); 
  dropArea.style.borderColor = '#444'; 
});
dropArea.addEventListener('drop', async e => {
  e.preventDefault(); 
  dropArea.style.borderColor = '#444';
  if(e.dataTransfer.files.length) { 
    fileInput.files = e.dataTransfer.files; 
    previewFile(e.dataTransfer.files[0]); 
  }
});

fileInput.addEventListener('change', () => { 
  if(fileInput.files.length) previewFile(fileInput.files[0]); 
});

function previewFile(file) {
  const reader = new FileReader();
  reader.onload = ev => { 
    previewImg.src = ev.target.result; 
    previewImg.style.display = 'block'; 
  };
  reader.readAsDataURL(file);
}

// 업로드 버튼
uploadBtn.addEventListener('click', async () => {
  const file = fileInput.files[0];
  if(!file) return alert('파일을 선택하세요!');

  // 페이지 2로 전환 (로딩)
  showPage('loading');

  const cloudName = 'dretlhsrk';
  const uploadPreset = 'unsigned_preset';
  const url = `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`;
  const formData = new FormData();
  formData.append('file', file);
  formData.append('upload_preset', uploadPreset);

  try {
    const res = await fetch(url, {method: 'POST', body: formData});
    const data = await res.json();
    
    if(data.secure_url) {
      const previewUrl = `${location.origin}/view.html?img=${encodeURIComponent(data.secure_url)}`;
      linkDisplay.value = previewUrl;

      // 복사 버튼
      copyBtn.onclick = () => {
        navigator.clipboard.writeText(previewUrl).then(() => {
          const originalText = copyBtn.textContent;
          copyBtn.textContent = "✔";
          copyBtn.style.background = "linear-gradient(135deg,#00cc88,#33ff99)";
          setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = "linear-gradient(135deg,#00ffcc,#3366ff)";
          }, 1500);
        });
      };

      openPreviewBtn.onclick = () => window.open(previewUrl, '_blank');

      // 페이지 3으로 전환 (완료)
      showPage('complete');
    } else {
      throw new Error('업로드 실패');
    }
  } catch(e) {
    alert('업로드 실패');
    showPage('upload'); // 실패시 첫 페이지로
  }
});

// 새로 업로드 버튼
newUploadBtn.addEventListener('click', () => {
  fileInput.value = '';
  previewImg.style.display = 'none';
  previewImg.src = '';
  linkDisplay.value = '';
  showPage('upload');
});
</script>
</body>
</html>
