<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‹¡ê§ì •ë¹ˆ777ê§‚ - íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°</title>
<link rel="icon" type="image/svg+xml" href='data:image/svg+xml;utf8,
<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 2000 2000">
  <defs>
    <linearGradient id="linearGradient1" x1="1576.7" y1="1817" x2="423.3" y2="183" gradientUnits="userSpaceOnUse">
      <stop offset="0" stop-color="%233478f6"/>
      <stop offset="1" stop-color="%2353b6f9"/>
    </linearGradient>
    <filter id="filter1" x="0" y="0" width="2000" height="2000" color-interpolation-filters="sRGB">
      <feFlood flood-color="%23000000" flood-opacity="0.52"/>
      <feComposite in2="SourceGraphic" operator="out"/>
      <feGaussianBlur stdDeviation="43"/>
      <feOffset dx="35" dy="24"/>
      <feComposite in2="SourceGraphic" operator="atop"/>
    </filter>
  </defs>
  <path fill="url(%23linearGradient1)" d="M 2000 1000 C 2000 448 1552 0 1000 0 C 448 0 0 448 0 1000 C 0 1552 448 2000 1000 2000 C 1552 2000 2000 1552 2000 1000 Z"/>
  <path fill="%23fff" filter="url(%23filter1)" d="M 1137 506 C 1252 449 1369 497 1427 625 L 1459 696 C 1484 752 1488 821 1471 878 L 1472 877 C 1535 891 1581 939 1608 997 L 1632 1052 C 1698 1199 1657 1324 1544 1381 L 1175 1565 L 972 1114 C 1002 1241 946 1377 834 1433 L 776 1462 C 654 1523 518 1467 449 1343 L 596 1269 C 625 1309 663 1331 708 1308 L 758 1283 C 813 1256 830 1185 802 1124 L 525 509 L 672 435 L 784 683 L 1137 506 Z M 1444 1232 C 1488 1210 1504 1149 1480 1095 L 1476 1085 C 1452 1033 1397 1007 1353 1029 L 1151 1130 L 1242 1333 L 1444 1232 Z M 1184 679 L 991 775 L 1084 981 L 1276 885 C 1319 864 1336 802 1312 749 L 1306 736 C 1283 684 1226 658 1184 679 Z"/>
</svg>' />

<!-- ê³µí†µ í—¤ë” CSS -->
<link rel="stylesheet" href="header.css">

<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: #ffffff; overflow-x: hidden; min-height: 100vh; display: flex; flex-direction: column; }

  main { padding: 20px; margin: 0; flex: 1; display: flex; align-items: center; justify-content: center; }

  #container { 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    background: #1a1a1a; 
    padding: 40px 30px; 
    border-radius: 16px; 
    box-shadow: 0 0 30px rgba(0,0,0,0.6); 
    max-width: 90%; 
    width: 100%; 
    margin: 20px; 
  }

  h2 { margin-bottom: 30px; font-size: 28px; color: #3663FF; text-align: center; }

  #fileContainer { 
    display: flex; 
    flex-direction: column; 
    justify-content: center; 
    align-items: center; 
    margin-bottom: 20px; 
    width: 100%; 
  }

  #fileContainer img { 
    max-width: 90vw; 
    max-height: 60vh; 
    border-radius: 12px; 
    box-shadow: 0 8px 25px rgba(54,99,255,0.3); 
  }

  .file-icon-display { text-align: center; padding: 40px; }
  .file-icon-display .icon { font-size: 120px; margin-bottom: 20px; animation: fadeIn 0.3s ease-in; }
  .file-icon-display .file-name { color: #aaa; font-size: 18px; word-break: break-all; margin-bottom: 10px; }
  .file-icon-display .file-info { color: #666; font-size: 14px; margin-bottom: 20px; }

  .download-button { 
    background: #3663FF; 
    color: #fff; 
    padding: 16px 40px; 
    border: none; 
    border-radius: 30px; 
    cursor: pointer; 
    font-size: 18px; 
    transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
    margin-top: 10px; 
  }
  .download-button:hover { transform: translateY(-8px) scale(1.05); }
  .download-button:active { background: #2952CC; }

  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.8); }
    to { opacity: 1; transform: scale(1); }
  }

  #fileContainer p { color: #aaa; font-size: 18px; }

  .action-button { 
    background: #3663FF; 
    color: #fff; 
    padding: 12px 28px; 
    margin: 8px; 
    border: none; 
    border-radius: 30px; 
    cursor: pointer; 
    font-size: 16px; 
    transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
    white-space: nowrap; 
    display: none; 
  }
  .action-button:hover { transform: translateY(-8px) scale(1.05); }
  .action-button:active { background: #2952CC; }
  .action-button.show { display: inline-block; }

  .button-container { 
    display: flex; 
    gap: 10px; 
    flex-wrap: wrap; 
    justify-content: center; 
    margin-top: 10px; 
  }

  .original-link { 
    margin-top: 15px; 
    color: #3663FF; 
    text-decoration: none; 
    font-size: 14px; 
    display: none; 
  }
  .original-link:hover { text-decoration: underline; }
  .original-link.show { display: inline-block; }

  .spinner { 
    width:70px; 
    height:70px; 
    border:5px solid rgba(54,99,255,0.2); 
    border-top-color:#3663FF; 
    border-radius:50%; 
    animation:spin 1s linear infinite; 
    margin:30px auto; 
  }
  @keyframes spin { to { transform:rotate(360deg); } }

  @media (max-width: 800px) {
    #container { padding: 30px 20px; margin: 15px; }
    h2 { font-size: 24px; margin-bottom: 20px; }
    #fileContainer img, #fileContainer video { max-height: 50vh; }
    #fileContainer iframe { width: 95vw; height: 60vh; }
    .file-icon-display .icon { font-size: 80px; }
    .button-container { flex-direction: column; width: 100%; }
    .action-button { width: 100%; }
  }
</style>
</head>
<body>

<!-- í—¤ë” ì»¨í…Œì´ë„ˆ -->
<div id="header-container"></div>

<main>
<div id="container">
  <h2>ğŸ“ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°</h2>
  <div id="fileContainer">
    <div class="spinner"></div>
    <p>ë¡œë”© ì¤‘...</p>
  </div>
  <div class="button-container">
    <button class="action-button" id="copyLinkBtn">ğŸ”— ë¯¸ë¦¬ë³´ê¸° ë§í¬ ë³µì‚¬</button>
    <button class="action-button" id="downloadBtn">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
  </div>
  <a id="originalLink" class="original-link" href="#" target="_blank">ğŸ” ì›ë³¸ íŒŒì¼ ìƒˆì°½ì—ì„œ ë³´ê¸°</a>
</div>
</main>

<!-- ê³µí†µ í—¤ë” JavaScript -->
<script src="header.js"></script>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

const firebaseConfig = {
  apiKey: "AIzaSyB8OHhR0Vjan_nNdCczb5e2bOuDBYYRiIg",
  authDomain: "urlshare-718c1.firebaseapp.com",
  databaseURL: "https://urlshare-718c1-default-rtdb.firebaseio.com",
  projectId: "urlshare-718c1",
  storageBucket: "urlshare-718c1.firebasestorage.app",
  messagingSenderId: "666729308999",
  appId: "1:666729308999:web:a7f6d363e88b1d5ed5a262",
  measurementId: "G-VZH9BNQ3VR"
};

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

// URL íŒŒë¼ë¯¸í„° í™•ì¸
const params = new URLSearchParams(location.search);
const shortCode = params.get("s");
const directFileUrl = params.get("img");

window.resolvedFileUrl = null;

// ë‹¨ì¶• ì½”ë“œê°€ ìˆìœ¼ë©´ Firebaseì—ì„œ ê°€ì ¸ì˜¤ê¸°
if (shortCode) {
  get(ref(database, 'urls/' + shortCode)).then((snapshot) => {
    if (snapshot.exists()) {
      const data = snapshot.val();
      const longUrl = data.longUrl;
      
      // longUrlì—ì„œ img íŒŒë¼ë¯¸í„° ì¶”ì¶œ
      const longUrlParams = new URLSearchParams(longUrl.split('?')[1]);
      const fileUrl = longUrlParams.get('img');
      
      if (fileUrl) {
        window.resolvedFileUrl = fileUrl;
        window.loadFile(fileUrl);
      } else {
        showError('íŒŒì¼ URLì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    } else {
      showError('ìœ íš¨í•˜ì§€ ì•Šì€ ë‹¨ì¶• ë§í¬ì…ë‹ˆë‹¤.');
    }
  }).catch((error) => {
    console.error('Firebase ì—ëŸ¬:', error);
    showError('ë§í¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  });
} else if (directFileUrl) {
  // ì§ì ‘ img íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ ë°”ë¡œ ì‚¬ìš©
  window.resolvedFileUrl = directFileUrl;
  window.loadFile(directFileUrl);
} else {
  showError('íŒŒì¼ URLì´ ì—†ìŠµë‹ˆë‹¤.');
}

function showError(message) {
  const fileContainer = document.getElementById('fileContainer');
  fileContainer.innerHTML = `<p>âŒ ${message}</p>`;
}
</script>

<script>
const fileContainer = document.getElementById('fileContainer');
const copyLinkBtn = document.getElementById('copyLinkBtn');
const downloadBtn = document.getElementById('downloadBtn');
const originalLink = document.getElementById('originalLink');

// íŒŒì¼ íƒ€ì…ë³„ ì•„ì´ì½˜
function getFileIcon(url) {
  const ext = url.split('.').pop().split('?')[0].toLowerCase();
  const icons = {
    'pdf': 'ğŸ“„',
    'doc': 'ğŸ“', 'docx': 'ğŸ“',
    'txt': 'ğŸ“ƒ', 'rtf': 'ğŸ“ƒ',
    'xls': 'ğŸ“Š', 'xlsx': 'ğŸ“Š', 'csv': 'ğŸ“Š',
    'ppt': 'ğŸ“½ï¸', 'pptx': 'ğŸ“½ï¸',
    'zip': 'ğŸ—œï¸', 'rar': 'ğŸ—œï¸', '7z': 'ğŸ—œï¸', 'tar': 'ğŸ—œï¸', 'gz': 'ğŸ—œï¸',
    'mp4': 'ğŸ¬', 'avi': 'ğŸ¬', 'mov': 'ğŸ¬', 'mkv': 'ğŸ¬', 'webm': 'ğŸ¬', 'flv': 'ğŸ¬', 'wmv': 'ğŸ¬',
    'mp3': 'ğŸµ', 'wav': 'ğŸµ', 'flac': 'ğŸµ', 'm4a': 'ğŸµ', 'ogg': 'ğŸµ', 'aac': 'ğŸµ',
    'html': 'ğŸ’»', 'css': 'ğŸ’»', 'js': 'ğŸ’»', 'py': 'ğŸ’»', 'java': 'ğŸ’»',
    'cpp': 'ğŸ’»', 'c': 'ğŸ’»', 'php': 'ğŸ’»', 'json': 'ğŸ’»',
    'xml': 'ğŸ’»', 'sql': 'ğŸ’»', 'sh': 'ğŸ’»',
    'jpg': 'ğŸ–¼ï¸', 'jpeg': 'ğŸ–¼ï¸', 'png': 'ğŸ–¼ï¸', 'gif': 'ğŸ–¼ï¸',
    'bmp': 'ğŸ–¼ï¸', 'svg': 'ğŸ–¼ï¸', 'webp': 'ğŸ–¼ï¸', 'heic': 'ğŸ–¼ï¸', 
    'heif': 'ğŸ–¼ï¸', 'tiff': 'ğŸ–¼ï¸', 'tif': 'ğŸ–¼ï¸',
  };
  return icons[ext] || 'ğŸ“';
}

// íŒŒì¼ íƒ€ì… ê°ì§€
function getFileType(url) {
  const ext = url.split('.').pop().split('?')[0].toLowerCase();
  if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg'].includes(ext)) {
    return 'image';
  } else {
    return 'other';
  }
}

// íŒŒì¼ëª… ì¶”ì¶œ
function getFileName(url) {
  try {
    const urlObj = new URL(url);
    const pathname = urlObj.pathname;
    const parts = pathname.split('/');
    return decodeURIComponent(parts[parts.length - 1]) || 'íŒŒì¼';
  } catch {
    return 'íŒŒì¼';
  }
}

// íŒŒì¼ ë¡œë“œ í•¨ìˆ˜
window.loadFile = function(fileUrl) {
  const fileType = getFileType(fileUrl);
  const fileName = getFileName(fileUrl);
  
  fileContainer.innerHTML = '';

  if (fileType === 'image') {
    // ì´ë¯¸ì§€ í‘œì‹œ
    const img = document.createElement('img');
    img.src = fileUrl;
    img.alt = 'ì—…ë¡œë“œëœ ì´ë¯¸ì§€';
    fileContainer.appendChild(img);
    document.querySelector('h2').textContent = 'ğŸ–¼ï¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°';

    // ì´ë¯¸ì§€ìš© ë²„íŠ¼ë“¤
    copyLinkBtn.classList.add('show');
    downloadBtn.classList.add('show');
    originalLink.classList.add('show');
    originalLink.href = fileUrl;
  } else {
    // ê¸°íƒ€ ëª¨ë“  íŒŒì¼ - ì•„ì´ì½˜ + ë‹¤ìš´ë¡œë“œ ë²„íŠ¼
    const iconDiv = document.createElement('div');
    iconDiv.className = 'file-icon-display';
    iconDiv.innerHTML = `
      <div class="icon">${getFileIcon(fileUrl)}</div>
      <div class="file-name">${fileName}</div>
      <div class="file-info">ë‹¤ìš´ë¡œë“œí•˜ì—¬ íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”</div>
      <button class="download-button" id="mainDownloadBtn">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
    `;
    fileContainer.appendChild(iconDiv);

    // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('mainDownloadBtn').addEventListener('click', async () => {
      try {
        const response = await fetch(fileUrl);
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
      } catch (error) {
        console.error('ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
        alert('ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
      }
    });

    // ë§í¬ ë³µì‚¬ ë²„íŠ¼ë§Œ í‘œì‹œ
    copyLinkBtn.classList.add('show');
  }

  // ë¯¸ë¦¬ë³´ê¸° ë§í¬ ë³µì‚¬
  copyLinkBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(window.location.href).then(() => {
      const originalText = copyLinkBtn.textContent;
      copyLinkBtn.textContent = "âœ” ë³µì‚¬ ì™„ë£Œ!";
      copyLinkBtn.style.background = "#00cc88";
      setTimeout(() => {
        copyLinkBtn.textContent = originalText;
        copyLinkBtn.style.background = "#3663FF";
      }, 1500);
    }).catch(() => {
      alert('ë³µì‚¬ ì‹¤íŒ¨');
    });
  });

  // ì´ë¯¸ì§€ìš© ë‹¤ìš´ë¡œë“œ
  if (fileType === 'image') {
    downloadBtn.addEventListener('click', async () => {
      try {
        const response = await fetch(fileUrl);
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
      } catch (error) {
        alert('ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨');
      }
    });
  }
};
</script>

</body>
</html>
