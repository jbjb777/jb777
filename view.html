<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‹¡ê§ì •ë¹ˆ777ê§‚ - íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°</title>
<link rel="icon" type="image/svg+xml" href='data:image/svg+xml;utf8,
<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 2000 2000">
  <defs>
    <linearGradient id="linearGradient1" x1="1576.7" y1="1817" x2="423.3" y2="183" gradientUnits="userSpaceOnUse">
      <stop offset="0" stop-color="%233478f6"/>
      <stop offset="1" stop-color="%2353b6f9"/>
    </linearGradient>
    <filter id="filter1" x="0" y="0" width="2000" height="2000" color-interpolation-filters="sRGB">
      <feFlood flood-color="%23000000" flood-opacity="0.52"/>
      <feComposite in2="SourceGraphic" operator="out"/>
      <feGaussianBlur stdDeviation="43"/>
      <feOffset dx="35" dy="24"/>
      <feComposite in2="SourceGraphic" operator="atop"/>
    </filter>
  </defs>
  <path fill="url(%23linearGradient1)" d="M 2000 1000 C 2000 448 1552 0 1000 0 C 448 0 0 448 0 1000 C 0 1552 448 2000 1000 2000 C 1552 2000 2000 1552 2000 1000 Z"/>
  <path fill="%23fff" filter="url(%23filter1)" d="M 1137 506 C 1252 449 1369 497 1427 625 L 1459 696 C 1484 752 1488 821 1471 878 L 1472 877 C 1535 891 1581 939 1608 997 L 1632 1052 C 1698 1199 1657 1324 1544 1381 L 1175 1565 L 972 1114 C 1002 1241 946 1377 834 1433 L 776 1462 C 654 1523 518 1467 449 1343 L 596 1269 C 625 1309 663 1331 708 1308 L 758 1283 C 813 1256 830 1185 802 1124 L 525 509 L 672 435 L 784 683 L 1137 506 Z M 1444 1232 C 1488 1210 1504 1149 1480 1095 L 1476 1085 C 1452 1033 1397 1007 1353 1029 L 1151 1130 L 1242 1333 L 1444 1232 Z M 1184 679 L 991 775 L 1084 981 L 1276 885 C 1319 864 1336 802 1312 749 L 1306 736 C 1283 684 1226 658 1184 679 Z"/>
</svg>' />

<link rel="stylesheet" href="header.css">

<style>
  /* (ê¸°ì¡´ CSS ê·¸ëŒ€ë¡œ, ì ˆëŒ€ ìˆ˜ì • ì—†ìŒ) */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    background: #121212; 
    color: #ffffff; 
    overflow-x: hidden; 
    min-height: 100vh; 
    display: flex; 
    flex-direction: column; 
  }
  main { padding: 20px; flex: 1; display: flex; align-items: center; justify-content: center; }
  #container { background: #1a1a1a; padding: 40px 30px; border-radius: 16px; box-shadow: 0 0 30px rgba(0,0,0,0.6); max-width: 90%; width: 100%; margin: 20px; display:flex; flex-direction:column; align-items:center; }
  h2 { margin-bottom: 30px; font-size: 28px; color: #3663FF; }
  #fileContainer img { max-width: 90vw; max-height: 60vh; border-radius: 12px; box-shadow: 0 8px 25px rgba(54,99,255,0.3); }
  .action-button { background: #3663FF; color: #fff; padding: 12px 28px; margin: 8px; border:none; border-radius:30px; font-size:16px; cursor:pointer; display:none; }
  .action-button.show { display:inline-block; }
  #originalLink { color:#3663FF; display:none; }
  #originalLink.show { display:inline-block; }
</style>
</head>
<body>

<div id="header-container"></div>

<main>
  <div id="container">
    <h2>ğŸ“ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°</h2>
    <div id="fileContainer"></div>
    <div class="button-container">
      <button class="action-button" id="copyLinkBtn">ğŸ”— ë¯¸ë¦¬ë³´ê¸° ë§í¬ ë³µì‚¬</button>
      <button class="action-button" id="downloadBtn">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
    </div>
    <a id="originalLink" class="original-link" href="#" target="_blank">ğŸ” ì›ë³¸ íŒŒì¼ ìƒˆì°½ì—ì„œ ë³´ê¸°</a>
  </div>
</main>

<script src="header.js"></script>

<!-- âœ… Firebase ë‹¨ì¶•ë§í¬ ìë™ ì²˜ë¦¬ ì¶”ê°€ -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_AUTH",
  databaseURL: "YOUR_DB",
  projectId: "YOUR_PROJ",
  storageBucket: "YOUR_BUCKET",
  messagingSenderId: "YOUR_SENDER",
  appId: "YOUR_APP"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// âœ… ê¸°ì¡´ fileUrl ë¨¼ì € í™•ì¸
let params = new URLSearchParams(location.search);
let fileUrl = params.get("img");

// âœ… ì—†ë‹¤ë©´ â†’ ë‹¨ì¶•URL í™•ì¸
if (!fileUrl) {
  const shortKey = window.location.pathname.replace("/", "").trim();

  if (shortKey.length > 0) {
    const refPath = ref(db, `short/${shortKey}`);

    get(refPath).then(snapshot => {
      if (snapshot.exists()) {
        // ì‹¤ì œ URL ì±„ì›Œ ë„£ê³  ê¸°ì¡´ ì½”ë“œ ì¬ì‹¤í–‰
        fileUrl = snapshot.val();
        initPreview(fileUrl);
      } else {
        document.getElementById("fileContainer").innerHTML = "<p>âŒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë‹¨ì¶• ë§í¬ì…ë‹ˆë‹¤.</p>";
      }
    });
  }
} else {
  initPreview(fileUrl);
}

// âœ… ê¸°ì¡´ ë¯¸ë¦¬ë³´ê¸° ì²˜ë¦¬ í•¨ìˆ˜ ê·¸ëŒ€ë¡œ
function initPreview(fileUrl) {
  const fileContainer = document.getElementById('fileContainer');
  const copyLinkBtn = document.getElementById('copyLinkBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const originalLink = document.getElementById('originalLink');

  const ext = fileUrl.split('.').pop().split('?')[0].toLowerCase();
  const isImage = ['jpg','jpeg','png','gif','bmp','webp','svg','heic','heif','tiff','tif'].includes(ext);

  if (isImage) {
    const img = document.createElement('img');
    img.src = fileUrl;
    fileContainer.appendChild(img);

    document.querySelector('h2').textContent = 'ğŸ–¼ï¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°';
    copyLinkBtn.classList.add('show');
    downloadBtn.classList.add('show');
    originalLink.classList.add('show');
    originalLink.href = fileUrl;

    downloadBtn.addEventListener('click', async () => {
      const r = await fetch(fileUrl);
      const blob = await r.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "image";
      a.click();
      window.URL.revokeObjectURL(url);
    });

  } else {
    fileContainer.innerHTML = "<p>íŒŒì¼ ìœ í˜•ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œí•˜ì—¬ í™•ì¸í•˜ì„¸ìš”.</p>";
    downloadBtn.classList.add('show');
    downloadBtn.addEventListener('click', () => window.open(fileUrl));
  }

  copyLinkBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(window.location.href);
    copyLinkBtn.textContent = "âœ” ë³µì‚¬ ì™„ë£Œ!";
    setTimeout(() => (copyLinkBtn.textContent = "ğŸ”— ë¯¸ë¦¬ë³´ê¸° ë§í¬ ë³µì‚¬"), 1500);
  });
}
</script>

</body>
</html>
