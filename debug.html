<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã‹¡ê§ì •ë¹ˆ777ê§‚ - í™ˆ</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #121212;
      color: #ffffff;
      padding: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background-color: #1e1e1e;
      border-radius: 12px;
      margin-bottom: 30px;
    }

    .logo {
      font-size: 22px;
      font-weight: bold;
      color: #ffffff;
    }

    .login-area {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-info {
      display: none;
      align-items: center;
      gap: 12px;
      background: rgba(54, 99, 255, 0.15);
      padding: 12px 20px;
      border-radius: 25px;
      border: 2px solid rgba(54, 99, 255, 0.4);
    }

    .user-info.active {
      display: flex;
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid #3663FF;
    }

    .user-name {
      font-size: 15px;
      color: #fff;
      font-weight: 600;
    }

    .logout-btn {
      background: #ff4444;
      color: #fff;
      padding: 8px 18px;
      border: none;
      border-radius: 18px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .logout-btn:hover {
      background: #cc0000;
      transform: translateY(-2px);
    }

    .content {
      background: #1e1e1e;
      padding: 40px;
      border-radius: 12px;
      text-align: center;
    }

    .status {
      margin-top: 20px;
      padding: 15px;
      background: #2a2a2a;
      border-radius: 8px;
      font-family: monospace;
      font-size: 14px;
      text-align: left;
      max-width: 600px;
      margin: 20px auto;
    }

    .status-line {
      margin: 5px 0;
      color: #aaa;
    }

    .status-ok {
      color: #4CAF50;
    }

    .status-error {
      color: #f44336;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">ã‹¡ê§ì •ë¹ˆ777ê§‚</div>
    
    <div class="login-area">
      <div class="user-info" id="userInfo">
        <img id="userAvatar" class="user-avatar" src="" alt="í”„ë¡œí•„">
        <span class="user-name" id="userName"></span>
        <button class="logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
      
      <div id="g_id_onload"
          data-client_id="657589319352-3ue0rjgjpsr11d48qva3alut62c8s3kk.apps.googleusercontent.com"
          data-callback="handleCredentialResponse"
          data-auto_prompt="false">
      </div>

      <div class="g_id_signin"
          data-type="standard"
          data-shape="rectangular"
          data-theme="outline"
          data-size="large"
          data-text="signin_with"
          data-logo_alignment="center">
      </div>
    </div>
  </header>

  <div class="content">
    <h1>êµ¬ê¸€ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h1>
    <p>ìœ„ì˜ ë²„íŠ¼ìœ¼ë¡œ ë¡œê·¸ì¸ì„ ì‹œë„í•´ë³´ì„¸ìš”.</p>
    
    <div class="status" id="statusLog">
      <div class="status-line">ğŸ” ë””ë²„ê·¸ ë¡œê·¸:</div>
    </div>
  </div>

  <!-- ì¼ë°˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë³€ê²½ (module ì œê±°) -->
  <script>
    // ë””ë²„ê·¸ ë¡œê·¸ í•¨ìˆ˜
    function addLog(message, type = 'info') {
      const log = document.getElementById('statusLog');
      const line = document.createElement('div');
      line.className = `status-line ${type === 'ok' ? 'status-ok' : type === 'error' ? 'status-error' : ''}`;
      line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      log.appendChild(line);
      console.log(message);
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    addLog('í˜ì´ì§€ ë¡œë“œë¨');
    
    // localStorage ì‚¬ìš© (sessionStorage ëŒ€ì‹ )
    // localStorageëŠ” ë¸Œë¼ìš°ì €ë¥¼ ë‹«ì•„ë„ ìœ ì§€ë˜ê³ , ë” ì•ˆì •ì ì…ë‹ˆë‹¤
    
    // JWT íŒŒì‹± í•¨ìˆ˜
    function parseJwt(token) {
      try {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(
          atob(base64)
            .split('')
            .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
            .join('')
        );
        return JSON.parse(jsonPayload);
      } catch (error) {
        addLog('JWT íŒŒì‹± ì‹¤íŒ¨: ' + error.message, 'error');
        return null;
      }
    }

    // êµ¬ê¸€ ë¡œê·¸ì¸ ì½œë°± (ì „ì—­ ìŠ¤ì½”í”„ì— ì„ ì–¸)
    window.handleCredentialResponse = function(response) {
      addLog('êµ¬ê¸€ ë¡œê·¸ì¸ ì½œë°± ì‹¤í–‰ë¨', 'ok');
      
      if (!response || !response.credential) {
        addLog('ì‘ë‹µ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
        return;
      }

      const userData = parseJwt(response.credential);
      
      if (!userData) {
        addLog('ì‚¬ìš©ì ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨', 'error');
        return;
      }

      addLog(`ì‚¬ìš©ì ì •ë³´: ${userData.name} (${userData.email})`, 'ok');
      
      // localStorageì— ì €ì¥
      const userDataToSave = {
        name: userData.name,
        email: userData.email,
        picture: userData.picture,
        sub: userData.sub,
        loginTime: new Date().toISOString()
      };
      
      try {
        localStorage.setItem('jb777_googleUser', JSON.stringify(userDataToSave));
        addLog('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì„±ê³µ', 'ok');
      } catch (error) {
        addLog('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì‹¤íŒ¨: ' + error.message, 'error');
      }
      
      updateLoginUI(userDataToSave);
      
      // ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ë°œìƒ
      window.dispatchEvent(new CustomEvent('jb777-login', { detail: userDataToSave }));
    };

    // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateLoginUI(userData) {
      addLog('UI ì—…ë°ì´íŠ¸ ì‹œì‘', 'ok');
      
      const userInfo = document.getElementById('userInfo');
      const userName = document.getElementById('userName');
      const userAvatar = document.getElementById('userAvatar');
      const signInBtn = document.querySelector('.g_id_signin');
      
      if (userName) userName.textContent = userData.name;
      if (userAvatar && userData.picture) userAvatar.src = userData.picture;
      if (userInfo) userInfo.classList.add('active');
      if (signInBtn) signInBtn.style.display = 'none';
      
      addLog('ë¡œê·¸ì¸ UI í‘œì‹œ ì™„ë£Œ', 'ok');
    }

    // UI ì´ˆê¸°í™” í•¨ìˆ˜
    function clearLoginUI() {
      addLog('ë¡œê·¸ì•„ì›ƒ UI ì—…ë°ì´íŠ¸');
      
      const userInfo = document.getElementById('userInfo');
      const signInBtn = document.querySelector('.g_id_signin');
      
      if (userInfo) userInfo.classList.remove('active');
      if (signInBtn) signInBtn.style.display = 'inline-block';
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ í™•ì¸
    window.addEventListener('DOMContentLoaded', function() {
      addLog('DOM ë¡œë“œ ì™„ë£Œ');
      
      try {
        const savedUser = localStorage.getItem('jb777_googleUser');
        
        if (savedUser) {
          addLog('ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ ë°œê²¬', 'ok');
          const userData = JSON.parse(savedUser);
          updateLoginUI(userData);
        } else {
          addLog('ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ ì—†ìŒ');
        }
      } catch (error) {
        addLog('ë¡œê·¸ì¸ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message, 'error');
      }
    });

    // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì´ë²¤íŠ¸
    document.addEventListener('DOMContentLoaded', function() {
      const logoutBtn = document.getElementById('logoutBtn');
      
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          addLog('ë¡œê·¸ì•„ì›ƒ ì‹œë„');
          
          try {
            localStorage.removeItem('jb777_googleUser');
            addLog('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ ì™„ë£Œ', 'ok');
          } catch (error) {
            addLog('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
          }
          
          clearLoginUI();
          
          // êµ¬ê¸€ ìë™ ë¡œê·¸ì¸ ë¹„í™œì„±í™”
          if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
            google.accounts.id.disableAutoSelect();
            addLog('êµ¬ê¸€ ìë™ ì„ íƒ ë¹„í™œì„±í™”', 'ok');
          }
          
          // ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ë°œìƒ
          window.dispatchEvent(new CustomEvent('jb777-logout'));
          
          addLog('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ', 'ok');
        });
      }
    });

    // Google API ë¡œë“œ í™•ì¸
    window.addEventListener('load', function() {
      setTimeout(function() {
        if (typeof google !== 'undefined' && google.accounts) {
          addLog('êµ¬ê¸€ API ë¡œë“œ ì™„ë£Œ', 'ok');
        } else {
          addLog('êµ¬ê¸€ API ë¡œë“œ ì‹¤íŒ¨', 'error');
        }
      }, 1000);
    });
  </script>
</body>
</html>
